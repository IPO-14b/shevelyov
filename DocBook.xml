<?xml version="1.0" encoding="UTF-8"?>

<!-- New XML document created with EditiX XML Editor (http://www.editix.com) at Thu May 25 22:32:33 MSK 2017 -->

<article>
    <title>Internet Connection Speed Checker</title>
    <para>(расширение для браузера)</para>
    <para>Использован popup.js</para>
    <abstract>
        <title>Пример 1: Удачная проверка скорости</title>
        <para>Скорость определяется путём загрузки изображения и замером времени его загрузки на устройство.</para>
        <para>Задаётся фиксированное количество байт загружаемого изображения.</para>
        <para>При запуске расширения в переменную startTime записывается время начала загрузки методом GetTime().</para>
        <para>Когда срабатывает обработчик onload, то также фиксируется Время завершения метод GetTime() в переменную endTime.</para>
        <para>По формуле рассчитывается скорость интернет-соединения пользователя.</para>
        <para>С помощью метода ShowProgressMessage в элемент ID progress отображается информация о процессе загрузки и итоговой скорости.</para>
        <programlisting>
	        function showResults() {
                var duration = (endTime - startTime) / 500;
                var bitsLoaded = downloadSize * 4;
                var speedBps = (bitsLoaded / duration).toFixed(1);
                var speedKbps = (speedBps / 1024).toFixed(1);
                var speedMbps = (speedKbps / 1024).toFixed(1);
                ShowProgressMessage([
                    "Your connection speed is: " + speedMbps + " Mbps"
                ]);
            }
   		</programlisting>
    </abstract>
    <abstract>
        <title>Пример 2: Браузер не поддерживает JS</title>
        <para>Подключение JS</para>
        <para>В HTML разметке подключается jquery и popup скрипты.</para>
        <para>В случае удачного подключения скриптов отображение скорости происходит с помощью обработчиков load/onload.</para>
        <para>В ином случае (неподдерживаемого браузера) отображается сообщение о том, что браузер не поддерживает воспроизведение скриптов.</para>
        <para>Exception обрабатывается на уровне HTML страницы, что позволяет оптимизировать код скрипта popup.js.</para>
        <programlisting>
            script src="jquery.js" type="text/javascript"
	        script src="popup.js" type="text/javascript"
        	body
	            h1 id="progress">JavaScript is turned off, or your browser is really slow.
            body
    	</programlisting>
    </abstract>
    <abstract>
        <title>Пример 3: Несоответствие изображения</title>
        <para>В скрипте фиксируется размер загружаемого изображения.</para>
        <para>Указывается прямая ссылка на загрузку изображения.</para>
        <para>Если размер изображения не соответствует размеру загружаемого изображение срабатывает обработчик on.error.</para>
        <para>Система даёт пользователю знать о некорректном изображении при помощт метода ShowProgressMessage на HTML странице.</para>
        <programlisting>
        	var imageAddr = "http://www.kenrockwell.com/contax/images/g2/examples/31120037-5mb.jpg"; 
            var downloadSize = 4995374; //bytes
            function MeasureConnectionSpeed() {
    			var startTime, endTime;
    			var download = new Image();
    			download.onload = function () {
        			endTime = (new Date()).getTime();
        			showResults();
    				}
				download.onerror = function (err, msg) {
				        ShowProgressMessage("Invalid image, or error downloading");
				}
			}
    	</programlisting>
    </abstract>
</article>
